压缩解压缩接口是对**已经上传到存储空间中的文件**进行压缩或解压缩处理，并将输出文件存储到用户指定的位置。由于服务是异步进行的，结果状态会在处理完成后以回调的方式通知用户。如果文件不在又拍云存储中，需要预先调用文件上传 API 将压缩文件上传至又拍云存储。

> 注：文中所有 `<>` 标注的字段，均需根据实际情况进行替换。

## 使用方法

### 请求方法

以 `POST` 方式向 `http://p0.api.upyun.com/pretreatment/` 提交处理请求，UPYUN 接受请求后立即返回任务 `task_id`，处理完成后会通过回调的方式通知用户。

例如：

```
curl -X POST \
    http://p0.api.upyun.com/pretreatment/ \
    -H "Authorization: UPYUN <operator>:<signature>" \
    -H "Date: <Wed, 29 Oct 2014 02:26:58 GMT>"
    -d "bucket_name=<bucket_name>" \
    -d "notify_url=<notify_url>" \
    -d "app_name=<app_name>" \
    -d "tasks=<base64 编码后的任务字符串>"
```

### 请求参数

|        参数       |    类型       | 必选     |   说明                           |
|-------------------|--------------|------|---------------------------------------|
| bucket_name       | string       |  是   | 文件所在空间名称                     |
| notify_url        | string       |  是   | 回调通知地址                         |
| tasks             | string       |  是   | 处理任务信息，详见下                 |
| app_name          | string       |  是   | 任务所使用的云处理程序，压缩打包为 `compress`，解压为 `depress`      |


`tasks` 参数通过下面三个步骤生成：

1\. 组装业务参数。一次最多可以提交 10 个处理任务。

```
[
	{
		"sources": "/source/t.zip",              //又拍云存储空间中内文件路径
		"save_as": "/result/t/",                 //保存路径
	},
  	{
		"sources": ["/source/a","/source/b.jpg",],   //又拍云存储空间中内文件或目录路径
		"save_as": "/result/a.zip"                   //保存路径
	},
	…
]
```

2\. 把组装好的参数转换为 JSON 字符串。

3\. 对 JSON 字符串进行 base64 编码处理。

### 授权认证

授权认证的方法与异步音视频处理授权认证方法完全一致，具体可参考 [授权认证](http://docs.upyun.com/cloud/av/#_4)。


### 回调通知

处理完成后，系统根据提交任务时的 `notify_url` 参数，将处理结果转换成 JSON 字符串，并以 `HTTP POST` 请求进行回调通知。

** 回调通知参数 **

|        参数       |    类型   |    说明                                                                                                      |
|-------------------|-----------|--------------------------------------------------------------------------------------------------------------|
| task_id      | string    | 任务对应的 TaskId                             |
| status_code  | integer   | 处理结果状态码，200 表示成功处理              |
| path         | string    | 输出文件保存路径                              |
| error        | string    | 处理错误信息描述，空字符串表示没有错误        |



## 处理参数

### 压缩

用于将用户 UPYUN 存储空间内多个文件或文件夹压缩打包成一个压缩文件。

|        参数       |    类型   |    说明                                                                           |
|-------------------|-----------|-----------------------------------------------------------------------------------|
| save_as           | string     | 压缩文件保存路径（需要为 `zip` 压缩文件），如 `</result/t.zip>`    |
| sources           | array      | 需要被压缩打包的文件或目录路径（空间内相对路径）|
| home_dir          | string     | 压缩文件内的目录结构可不包含的父目录。默认包含从根开始的全部目录。可选参数|


注
> - `sources` 内包含的文件最大数量 10000 个，总文件大小 1G
> - 压缩算法: 目前仅支持 `zip`，因此 `save_as` 需要以 `.zip` 后缀

#### home_dir 参数说明:
提交的任务格式如下:
```
[
	{
		"sources": ["a/b/c/source/1.jpg","a/b/c/source/2.jpg"],
		"save_as": "/result/t.zip",
		"home_dir": "a/b/c"
	},
]
```
则保存的压缩文件目录结构如下:
```
source
|-------1.jpg
|-------2.jpg
```


### 解压缩

用于将用户 UPYUN 存储空间内的压缩文件解压，并上传至指定目录。

|        参数       |    类型   |    说明                                                                           |
|-------------------|-----------|-----------------------------------------------------------------------------------|
| save_as           | string    | 压缩文件保存路径（需要为目录），如 `</result/>`    |
| sources           | string     | 空间内压缩文件相对路径                            |


注
> - `sources` 内包含的文件最大大小为5G
> - 解压算法: 目前仅支持 `zip`，因此 `sources` 内的文件需要以 `.zip` 后缀

